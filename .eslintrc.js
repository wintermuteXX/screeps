module.exports = {
  root: true,
  env: {
    node: true,
    es2017: true,
  },
  parser: "@typescript-eslint/parser",
  parserOptions: {
    ecmaVersion: 2017,
    sourceType: "module",
    project: "./jsconfig.json",
  },
  plugins: ["@typescript-eslint"],
  extends: [
    "eslint:recommended",
    "prettier", // Must be last to override other configs
  ],
  rules: {
    // ECMAScript 2017 Standards
    "no-var": "error",
    "prefer-const": "error",
    "prefer-arrow-callback": "warn",
    "prefer-template": "warn",
    "prefer-destructuring": ["warn", {
      "array": false,
      "object": true
    }],
    
    // Code Organization
    "camelcase": ["warn", {
      "properties": "always",
      "ignoreDestructuring": false
    }],
    // "no-underscore-dangle": ["warn", {
    //   "allow": ["_rooms", "_cache", "_creepsByRole", "_init", "_behavior", "_updateMemory", "_getResourceFromMemory", "_shouldCreateCreep", "_harvestPowerCache", "_harvestPowerCacheTick", "_collectResource", "_withdrawResource", "_pickupResource", "_handleCollectionResult", "_updateMemoryWithActualAmount", "_getCarriedResources", "_updateMemoryWithCarriedResources", "_getDeliveryOrders", "_groupOrdersByTarget", "_isTargetValid", "_findBestTargetFromOrders", "_findMatchingNeed", "_findTerminalFallback", "_dropAllResources", "_updateMemoryAfterTransfer", "_calculateTransferAmount", "_handleTransferResult", "_validateCurrentTarget", "_createOrdersFromMemory", "_performBatchDelivery", "_calculateOptimalCenter", "_structureCounts"]
    // }],
    
    // Performance - Prevent require() in loops (but allow at module level)
    // Note: This is a best practice, but we can't easily detect require() in loops with static analysis
    // The rule is disabled here, but should be enforced via code review
    
    // Error Handling
    "no-undef": "error",
    "no-unused-vars": ["warn", {
      "argsIgnorePattern": "^(_|rc|creep)$",
      "varsIgnorePattern": "^(_|memoryEntry)$"
    }],
    
    // Best Practices
    "eqeqeq": ["error", "always"],
    "no-eval": "error",
    "no-implied-eval": "error",
    "no-new-func": "error",
    "no-return-assign": "error",
    "no-self-compare": "error",
    "no-sequences": "error",
    "no-throw-literal": "error",
    "no-unmodified-loop-condition": "warn",
    "no-unused-expressions": "warn",
    "no-useless-call": "warn",
    "no-useless-concat": "warn",
    "no-useless-return": "warn",
    "prefer-promise-reject-errors": "error",
    "radix": "error",
    "require-await": "warn",
    "vars-on-top": "off", // Allow const/let anywhere
    
    // Console restrictions
    "no-restricted-syntax": ["error", {
      "selector": "MemberExpression[object.name='console'][property.name='table']",
      "message": "console.table() is not allowed. Use console.log() with forEach or map instead."
    }],
    
    // Style (Prettier handles formatting, but we keep some rules for consistency)
    "eol-last": ["warn", "always"],
    
    // TypeScript-specific
    "@typescript-eslint/no-unused-vars": ["warn", {
      "argsIgnorePattern": "^(_|rc|creep)$",
      "varsIgnorePattern": "^(_|memoryEntry)$"
    }],
  },
  overrides: [
    {
      // Screeps global objects
      files: ["src/**/*.js"],
      globals: {
        "ATTACK": "readonly",
        "BOOSTS": "readonly",
        "CARRY": "readonly",
        "CLAIM": "readonly",
        "COLOR_BLUE": "readonly",
        "COLOR_BROWN": "readonly",
        "COLOR_CYAN": "readonly",
        "COLOR_GREEN": "readonly",
        "COLOR_GREY": "readonly",
        "COLOR_ORANGE": "readonly",
        "COLOR_PURPLE": "readonly",
        "COLOR_RED": "readonly",
        "COLOR_WHITE": "readonly",
        "COLOR_YELLOW": "readonly",
        "COMMODITIES": "readonly",
        "ConstructionSite": "readonly",
        "Creep": "readonly",
        "ERR_BUSY": "readonly",
        "ERR_FULL": "readonly",
        "ERR_GCL_NOT_ENOUGH": "readonly",
        "ERR_INVALID_ARGS": "readonly",
        "ERR_INVALID_TARGET": "readonly",
        "ERR_NAME_EXISTS": "readonly",
        "ERR_NO_BODYPART": "readonly",
        "ERR_NO_PATH": "readonly",
        "ERR_NOT_ENOUGH_ENERGY": "readonly",
        "ERR_NOT_ENOUGH_EXTENSIONS": "readonly",
        "ERR_NOT_ENOUGH_RESOURCES": "readonly",
        "ERR_NOT_FOUND": "readonly",
        "ERR_NOT_IN_RANGE": "readonly",
        "ERR_NOT_OWNER": "readonly",
        "ERR_RCL_NOT_ENOUGH": "readonly",
        "ERR_TIRED": "readonly",
        "EXTRACTOR_COOLDOWN": "readonly",
        "FIND_CONSTRUCTION_SITES": "readonly",
        "FIND_CREEPS": "readonly",
        "FIND_DEPOSITS": "readonly",
        "FIND_DROPPED_RESOURCES": "readonly",
        "FIND_EXIT": "readonly",
        "FIND_EXIT_BOTTOM": "readonly",
        "FIND_EXIT_LEFT": "readonly",
        "FIND_EXIT_RIGHT": "readonly",
        "FIND_EXIT_TOP": "readonly",
        "FIND_FLAGS": "readonly",
        "FIND_HOSTILE_CONSTRUCTION_SITES": "readonly",
        "FIND_HOSTILE_CREEPS": "readonly",
        "FIND_HOSTILE_POWER_CREEPS": "readonly",
        "FIND_HOSTILE_SPAWNS": "readonly",
        "FIND_HOSTILE_STRUCTURES": "readonly",
        "FIND_MINERALS": "readonly",
        "FIND_MY_CONSTRUCTION_SITES": "readonly",
        "FIND_MY_CREEPS": "readonly",
        "FIND_MY_POWER_CREEPS": "readonly",
        "FIND_MY_SPAWNS": "readonly",
        "FIND_MY_STRUCTURES": "readonly",
        "FIND_NUKES": "readonly",
        "FIND_POWER_CREEPS": "readonly",
        "FIND_RUINS": "readonly",
        "FIND_SOURCES": "readonly",
        "FIND_SOURCES_ACTIVE": "readonly",
        "FIND_STRUCTURES": "readonly",
        "FIND_TOMBSTONES": "readonly",
        "Flag": "readonly",
        "LOOK_CONSTRUCTION_SITES": "readonly",
        "LOOK_STRUCTURES": "readonly",
        "Game": "readonly",
        "HARVEST_POWER": "readonly",
        "HEAL": "readonly",
        "MarketCal": "readonly",
        "Memory": "readonly",
        "Mineral": "readonly",
        "MOVE": "readonly",
        "OK": "readonly",
        "PathFinder": "readonly",
        "PWR_DISRUPT_SOURCE": "readonly",
        "PWR_DISRUPT_SPAWN": "readonly",
        "PWR_DISRUPT_TERMINAL": "readonly",
        "PWR_DISRUPT_TOWER": "readonly",
        "PWR_FORTIFY": "readonly",
        "PWR_GENERATE_OPS": "readonly",
        "PWR_OPERATE_CONTROLLER": "readonly",
        "PWR_OPERATE_EXTENSION": "readonly",
        "PWR_OPERATE_FACTORY": "readonly",
        "PWR_OPERATE_LAB": "readonly",
        "PWR_OPERATE_OBSERVER": "readonly",
        "PWR_OPERATE_POWER": "readonly",
        "PWR_OPERATE_SPAWN": "readonly",
        "PWR_OPERATE_STORAGE": "readonly",
        "PWR_OPERATE_TERMINAL": "readonly",
        "PWR_OPERATE_TOWER": "readonly",
        "PWR_REGEN_MINERAL": "readonly",
        "PWR_REGEN_SOURCE": "readonly",
        "PWR_SHIELD": "readonly",
        "RawMemory": "readonly",
        "REACTION_TIME": "readonly",
        "REACTIONS": "readonly",
        "Resource": "readonly",
        "RESOURCE_ALLOY": "readonly",
        "RESOURCE_BATTERY": "readonly",
        "RESOURCE_BIOMASS": "readonly",
        "RESOURCE_CATALYZED_GHODIUM_ACID": "readonly",
        "RESOURCE_CATALYZED_GHODIUM_ALKALIDE": "readonly",
        "RESOURCE_CATALYZED_KEANIUM_ACID": "readonly",
        "RESOURCE_CATALYZED_KEANIUM_ALKALIDE": "readonly",
        "RESOURCE_CATALYZED_LEMERGIUM_ACID": "readonly",
        "RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE": "readonly",
        "RESOURCE_CATALYZED_UTRIUM_ACID": "readonly",
        "RESOURCE_CATALYZED_UTRIUM_ALKALIDE": "readonly",
        "RESOURCE_CATALYZED_ZYNTHIUM_ACID": "readonly",
        "RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE": "readonly",
        "RESOURCE_CATALYST": "readonly",
        "RESOURCE_CELL": "readonly",
        "RESOURCE_CIRCUIT": "readonly",
        "RESOURCE_COMPOSITE": "readonly",
        "RESOURCE_CONCENTRATE": "readonly",
        "RESOURCE_CONDENSATE": "readonly",
        "RESOURCE_CRYSTAL": "readonly",
        "RESOURCE_DEVICE": "readonly",
        "RESOURCE_EMANATION": "readonly",
        "RESOURCE_ENERGY": "readonly",
        "RESOURCE_ESSENCE": "readonly",
        "RESOURCE_EXTRACT": "readonly",
        "RESOURCE_FIXTURES": "readonly",
        "RESOURCE_FRAME": "readonly",
        "RESOURCE_GHODIUM": "readonly",
        "RESOURCE_GHODIUM_ACID": "readonly",
        "RESOURCE_GHODIUM_ALKALIDE": "readonly",
        "RESOURCE_GHODIUM_HYDRIDE": "readonly",
        "RESOURCE_GHODIUM_MELT": "readonly",
        "RESOURCE_GHODIUM_OXIDE": "readonly",
        "RESOURCE_HYDRAULICS": "readonly",
        "RESOURCE_HYDROGEN": "readonly",
        "RESOURCE_HYDROXIDE": "readonly",
        "RESOURCE_KEANIUM": "readonly",
        "RESOURCE_KEANIUM_ACID": "readonly",
        "RESOURCE_KEANIUM_ALKALIDE": "readonly",
        "RESOURCE_KEANIUM_BAR": "readonly",
        "RESOURCE_KEANIUM_HYDRIDE": "readonly",
        "RESOURCE_KEANIUM_OXIDE": "readonly",
        "RESOURCE_LEMERGIUM": "readonly",
        "RESOURCE_LEMERGIUM_ACID": "readonly",
        "RESOURCE_LEMERGIUM_ALKALIDE": "readonly",
        "RESOURCE_LEMERGIUM_BAR": "readonly",
        "RESOURCE_LEMERGIUM_HYDRIDE": "readonly",
        "RESOURCE_LEMERGIUM_OXIDE": "readonly",
        "RESOURCE_LIQUID": "readonly",
        "RESOURCE_MACHINE": "readonly",
        "RESOURCE_METAL": "readonly",
        "RESOURCE_MICROCHIP": "readonly",
        "RESOURCE_MIST": "readonly",
        "RESOURCE_MUSCLE": "readonly",
        "RESOURCE_OPS": "readonly",
        "RESOURCE_ORGANISM": "readonly",
        "RESOURCE_ORGANOID": "readonly",
        "RESOURCE_OXIDANT": "readonly",
        "RESOURCE_OXYGEN": "readonly",
        "RESOURCE_PHLEGM": "readonly",
        "RESOURCE_POWER": "readonly",
        "RESOURCE_PURIFIER": "readonly",
        "RESOURCE_REDUCTANT": "readonly",
        "RESOURCE_SILICON": "readonly",
        "RESOURCE_SPIRIT": "readonly",
        "RESOURCE_SWITCH": "readonly",
        "RESOURCE_TISSUE": "readonly",
        "RESOURCE_TRANSISTOR": "readonly",
        "RESOURCE_TUBE": "readonly",
        "RESOURCE_UTRIUM": "readonly",
        "RESOURCE_UTRIUM_ACID": "readonly",
        "RESOURCE_UTRIUM_ALKALIDE": "readonly",
        "RESOURCE_UTRIUM_BAR": "readonly",
        "RESOURCE_UTRIUM_HYDRIDE": "readonly",
        "RESOURCE_UTRIUM_LEMERGITE": "readonly",
        "RESOURCE_UTRIUM_OXIDE": "readonly",
        "RESOURCE_WIRE": "readonly",
        "RESOURCE_ZYNTHIUM": "readonly",
        "RESOURCE_ZYNTHIUM_ACID": "readonly",
        "RESOURCE_ZYNTHIUM_ALKALIDE": "readonly",
        "RESOURCE_ZYNTHIUM_BAR": "readonly",
        "RESOURCE_ZYNTHIUM_HYDRIDE": "readonly",
        "RESOURCE_ZYNTHIUM_KEANITE": "readonly",
        "RESOURCE_ZYNTHIUM_OXIDE": "readonly",
        "RESOURCES_ALL": "readonly",
        "Room": "readonly",
        "RoomPosition": "readonly",
        "RANGED_ATTACK": "readonly",
        "Source": "readonly",
        "Spawn": "readonly",
        "STRUCTURE_CONTAINER": "readonly",
        "STRUCTURE_CONTROLLER": "readonly",
        "STRUCTURE_EXTENSION": "readonly",
        "STRUCTURE_EXTRACTOR": "readonly",
        "STRUCTURE_FACTORY": "readonly",
        "STRUCTURE_INVADER_CORE": "readonly",
        "STRUCTURE_KEEPER_LAIR": "readonly",
        "STRUCTURE_LAB": "readonly",
        "STRUCTURE_LINK": "readonly",
        "STRUCTURE_NUKER": "readonly",
        "STRUCTURE_OBSERVER": "readonly",
        "STRUCTURE_PORTAL": "readonly",
        "STRUCTURE_POWER_BANK": "readonly",
        "STRUCTURE_POWER_SPAWN": "readonly",
        "STRUCTURE_RAMPART": "readonly",
        "STRUCTURE_ROAD": "readonly",
        "STRUCTURE_SPAWN": "readonly",
        "STRUCTURE_STORAGE": "readonly",
        "STRUCTURE_TERMINAL": "readonly",
        "STRUCTURE_TOWER": "readonly",
        "STRUCTURE_WALL": "readonly",
        "Structure": "readonly",
        "TERRAIN_MASK_LAVA": "readonly",
        "TERRAIN_MASK_SWAMP": "readonly",
        "TERRAIN_MASK_WALL": "readonly",
        "TOUGH": "readonly",
        "WORK": "readonly",
        "_": "readonly",
      },
    },
  ],
};

